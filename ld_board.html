<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ラッキー傭兵団 情報掲示板</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <link rel="stylesheet" href="ld_board.css" />
</head>
<body>
  <div class="app-root">
    <!-- 上部固定ヘッダー -->
    <header class="app-header">
      <h1 class="app-title">ラッキー傭兵団 情報掲示板</h1>

      <!-- ユーザー名 / パス -->
      <section class="user-panel">
        <div class="user-panel-row">
          <label class="user-input-label">
            ユーザー名
            <input
              id="userNameInput"
              type="text"
              placeholder="例）キノマル（空欄なら名無し）"
              autocomplete="username"
            />
          </label>
        </div>
        <div class="user-panel-row user-panel-row--tag">
          <label class="user-input-label user-input-label--tag">
            パス（2桁）
            <input
              id="userTagInput"
              type="password"
              inputmode="numeric"
              pattern="\d*"
              maxlength="2"
              placeholder="例）01"
              autocomplete="current-password"
            />
          </label>
          <div class="user-mode-info">
            <span id="userModeLabel" class="user-mode-label"></span>
            <button id="userModeToggleBtn" type="button" class="user-mode-toggle-btn">
              モード切替
            </button>
          </div>
        </div>
      </section>

      <!-- フィルター開閉ボタン -->
      <button id="filterToggleBtn" class="filter-toggle-btn" type="button">
        ▲フィルタを閉じる
      </button>

      <!-- フィルターセクション -->
      <section id="filterPanel" class="filter-panel">
        <div class="filter-row">
          <label class="filter-label">
            キーワード
            <input id="keywordInput" type="text" placeholder="キーワードを入力" />
          </label>
        </div>

        <div class="filter-row filter-row--targets">
          <span class="filter-caption">対象</span>
          <label><input id="targetBody" type="checkbox" checked />本文</label>
          <label><input id="targetTitle" type="checkbox" checked />タイトル</label>
          <label><input id="targetUser" type="checkbox" checked />ユーザー名</label>
        </div>

        <div class="filter-row filter-row--genres">
          <span class="filter-caption">ジャンル</span>
          <label><input id="genreNormal" type="checkbox" checked />通常</label>
          <label><input id="genreQa" type="checkbox" checked />質問・相談</label>
          <label><input id="genreReport" type="checkbox" checked />報告</label>
          <label><input id="genreAnnounce" type="checkbox" checked />アナウンス</label>
        </div>

        <div class="filter-row filter-row--extra">
          <label class="filter-checkbox">
            <input id="sinceMyLastCheckbox" type="checkbox" />
            自身の最終書込み以降のみ（要登録）
          </label>
          <label class="filter-checkbox">
            <input id="hasAttachmentCheckbox" type="checkbox" />
            盤面・画像付きコメントのみ
          </label>
        </div>

        <div class="filter-row filter-row--summary">
          <span id="currentFilterSummary" class="filter-summary"></span>
        </div>

        <div class="filter-row filter-row--actions">
          <button id="applyFilterBtn" type="button" class="filter-apply-btn">
            フィルタを適用
          </button>
          <button id="resetFilterBtn" type="button" class="filter-reset-btn">
            全解除
          </button>
        </div>
      </section>
    </header>

    <!-- メインコンテンツ -->
    <main class="app-main">
      <!-- ロード状態 -->
      <div id="initialLoading" class="initial-loading">
        読み込み中...
      </div>

      <!-- コメント一覧 -->
      <section id="threadContainer" class="thread-container"></section>

      <!-- さらに古いコメントを読み込む -->
      <div class="load-more-section">
        <button id="loadMoreBtn" type="button" class="load-more-btn">
          ▲さらに古いコメントを読み込む
        </button>
        <div id="loadMoreStatus" class="load-more-status"></div>
      </div>

      <!-- フッターの余白（スクロールしやすくするため） -->
      <div class="bottom-spacer"></div>
    </main>

    <!-- フッター：コメント入力エリア -->
    <footer class="app-footer">
      <div class="footer-toggle">
        <button id="footerToggle" type="button" class="footer-toggle-btn">
          ▼コメントの入力ツールを非表示(タップ)
        </button>
      </div>
      <div id="composerBody" class="footer-body footer-body--open">
        <!-- 返信中情報 -->
        <div id="replyInfoRow" class="reply-info-row reply-info-row--hidden">
          <span id="replyInfoText" class="reply-info-text"></span>
          <button id="cancelReplyBtn" type="button" class="reply-cancel-btn">返信を解除</button>
        </div>

        <!-- ジャンル選択 -->
        <div class="composer-row composer-row--genre" id="composerGenreRow">
          <span class="composer-caption">ジャンル</span>
          <label><input type="radio" name="genre" value="normal" checked />通常</label>
          <label><input type="radio" name="genre" value="qa" />質問・相談</label>
          <label><input type="radio" name="genre" value="report" />報告</label>
          <label><input type="radio" name="genre" value="announce" />アナウンス</label>
        </div>

        <!-- 本文入力 -->
        <div class="composer-row">
          <textarea
            id="commentBodyInput"
            rows="3"
            placeholder="コメントを入力（誹謗中傷や不適切な表現は禁止です）"
          ></textarea>
        </div>

        <!-- 添付ボタン -->
        <div class="composer-row composer-row--attach">
          <button id="attachBoardBtn" type="button" class="attach-btn">盤面IDを添付</button>
          <button id="attachImageBtn" type="button" class="attach-btn">画像を添付</button>
        </div>
        <div class="composer-row composer-row--attach-status">
          <span id="attachedBoardLabel" class="attach-chip attach-chip--hidden"></span>
          <button
            id="clearBoardAttachBtn"
            type="button"
            class="attach-chip-remove-btn attach-chip-remove-btn--hidden"
          >
            ×
          </button>
          <span id="attachedImageLabel" class="attach-chip attach-chip--hidden"></span>
          <button
            id="clearImageAttachBtn"
            type="button"
            class="attach-chip-remove-btn attach-chip-remove-btn--hidden"
          >
            ×
          </button>
        </div>

        <!-- 投稿ボタン -->
        <div class="composer-row composer-row--submit">
          <button id="submitCommentBtn" type="button" class="submit-btn">投稿する</button>
          <span id="composerStatus" class="composer-status"></span>
        </div>

        <!-- 画像ファイル入力（隠し） -->
        <input
          id="imageFileInput"
          type="file"
          accept="image/*"
          multiple
          style="display: none;"
        />
      </div>
    </footer>

    <!-- 画像モーダル -->
    <div id="imageModal" class="ld-modal-backdrop ld-modal-hidden">
      <div class="ld-modal">
        <button type="button" class="ld-modal-close-btn" data-modal-close="image">
          ×
        </button>
        <div class="ld-modal-body">
          <img id="modalImage" src="" alt="拡大画像" class="modal-image" />
        </div>
      </div>
    </div>

    <!-- 歯車メニュー（管理系） -->
    <div id="gearModal" class="ld-modal-backdrop ld-modal-hidden">
      <div class="ld-modal ld-modal--gear">
        <button type="button" class="ld-modal-close-btn" data-modal-close="gear">
          ×
        </button>
        <div class="ld-modal-header">
          <h2 class="ld-modal-title">コメント管理メニュー</h2>
        </div>
        <div id="gearModalBody" class="ld-modal-body ld-modal-body--gear">
          <!-- JSで動的に埋める -->
        </div>
      </div>
    </div>

    <!-- プロフィールモーダル -->
    <div id="profileModal" class="ld-modal-backdrop ld-modal-hidden">
      <div class="ld-modal ld-modal--profile">
        <button type="button" class="ld-modal-close-btn" data-modal-close="profile">
          ×
        </button>
        <div class="ld-modal-header">
          <h2 id="profileModalTitle" class="ld-modal-title">プロフィール</h2>
        </div>
        <div id="profileModalBody" class="ld-modal-body ld-modal-body--profile">
          <!-- JSで動的に埋める -->
        </div>
      </div>
    </div>

    <!-- トースト -->
    <div id="toastContainer" class="toast-container"></div>
  </div>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="ld_board.js"></script>
</body>
</html>
